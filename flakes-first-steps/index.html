<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer-when-downgrade">

    <title>Nix Flakes: first steps</title>
    <meta name="description" content="I keep getting questions about how to start with Nix. I believe the way to go in 2022 is to start with Flakes, so in this post I&#x27;ll describe just that.
If you want to learn Nix from first principles instead, I recommend Nix Pills and nix.dev.">

    <link rel="stylesheet" href="https://blog.kubukoz.com/main.css">
    <link rel="stylesheet" href="https://blog.kubukoz.com/custom.css">
    <link rel="icon" type="image/x-icon" href="/images/favicon.svg">

    

    
    
</head>
<body>
    
    <div class="cover-image" style="background-image: url(&#x2F;images&#x2F;snowflakes.jpg)"></div>
    
    <a class="skip-main" href="#main">Skip to content</a>
    <div class="container">
        <header>
            <h1 class="site-header">
                <a href="https:&#x2F;&#x2F;blog.kubukoz.com">Jakub Koz≈Çowski</a> | A 1.00000000000001x engineering blog
            </h1>
            <nav>
                
                
                
                <a  href="https:&#x2F;&#x2F;blog.kubukoz.com&#x2F;talks&#x2F;">Talks</a>
                
                
            </nav>
        </header>
        <main id="main" tabindex="-1">
            

<article class="post">
    <header>
        <h1>Nix Flakes: first steps</h1>
    </header>
    <div class="content">
        <p>I keep getting questions about how to start with Nix. I believe the way to go in 2022 is to start with Flakes, so in this post I'll describe just that.</p>
<p>If you want to learn Nix from first principles instead, I recommend <a rel="noopener" target="_blank" href="https://nixos.org/guides/nix-pills/">Nix Pills</a> and <a rel="noopener" target="_blank" href="https://nix.dev/">nix.dev</a>.</p>
<span id="continue-reading"></span><h2 id="teaser-what-s-in-it-for-me"><a class="zola-anchor" href="#teaser-what-s-in-it-for-me" aria-label="Anchor link for: teaser-what-s-in-it-for-me">Teaser: what's in it for me?</a></h2>
<p>Imagine you wanted to try out a program someone recommended to you, but you didn't want to install it before getting an impression.
Or maybe you want to ensure your team's project is always built with the same version of your build tools, regardless of what versions your team members might have installed on their machines.
Maybe you already <em>have</em> a version of Node that's too new for a project, and you'd like to downgrade in the scope of that project (while keeping the latest version installed).</p>
<p>Nix's shells allow you to do all of these. A shell creates a temporary environment in which the selected programs are available.</p>
<p>For example, without writing any Nix files I can open a shell with the <code>scala-cli</code> package:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> nix shell nixpkgs#scala-cli</span>

<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> scala-cli version</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Scala</span></span><span class="z-meta z-function-call z-arguments z-shell"> CLI version: 0.1.16</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Scala</span></span><span class="z-meta z-function-call z-arguments z-shell"> version (default</span><span class="z-meta z-function-call z-shell"></span>)<span class="z-meta z-function-call z-shell"><span class="z-support z-function z-colon z-shell">:</span></span><span class="z-meta z-function-call z-arguments z-shell"> 3.2.0</span>
</span></code></pre>
<p>Now get this: that command didn't actually <em>install</em> anything. When I leave the shell (with <code>exit</code> or <code>ctrl+d</code>), <code>scala-cli</code> is no longer usable, and it doesn't pollute my user environment.</p>
<p>To avoid repetition, share our shells with the team, and make them reproducible, we can define them in files. In that case, we would call <code>nix develop</code> inside the project's directory to open the shell it provides:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ls <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> making sure we&#39;re in a directory containing a flake</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">flake.lock</span></span><span class="z-meta z-function-call z-arguments z-shell">      flake.nix</span>

<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> nix develop <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> loads the environment</span><span class="z-comment z-line z-number-sign z-shell">
</span></span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> node<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>version</span></span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">v16.17.1</span></span>

<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> exit <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> restores the parent process&#39;s environment</span><span class="z-comment z-line z-number-sign z-shell">
</span></span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> node<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>version <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> doesn&#39;t work anymore</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">zsh:</span></span><span class="z-meta z-function-call z-arguments z-shell"> command not found: node</span>
</span></code></pre>
<p>Shells are just one usecase of Nix, but I find that they're the one that brings the most value with minimal learning effort.
Read on, and you will learn:</p>
<ul>
<li>how to make isolated, reproducible and shareable shells with Nix Flakes</li>
<li>where to find packages for those shells</li>
<li>some bits of Nix syntax and semantics</li>
</ul>
<p>and more. Let's get to it!</p>
<h2 id="what-is-nix"><a class="zola-anchor" href="#what-is-nix" aria-label="Anchor link for: what-is-nix">What is Nix?</a></h2>
<p>To get started with Flakes, it'd be nice if we knew what Nix was in the first place.</p>
<p><a rel="noopener" target="_blank" href="https://nixos.org/">Nix</a> is a purely functional package manager.
It has a unique combination of features that make it an interesting tool that can be used to solve a variety of problems - one of which is packaging a website (which is exactly how the page you're reading was generated and packaged).</p>
<h2 id="what-are-flakes"><a class="zola-anchor" href="#what-are-flakes" aria-label="Anchor link for: what-are-flakes">What are flakes?</a></h2>
<p>Flakes are a feature of Nix meant to enable distribution of Nix packages in a decentralized and reproducible manner.
They provide a standardized and consistent approach to dependency management, caching and the general user experience.</p>
<p>The <strong>main purpose</strong> of a Flake is to provide <em>outputs</em>: things like package definitions and shells.</p>
<p>Flakes can also depend on each other to produce these outputs. Flake dependencies are generally called <em>inputs</em>.</p>
<p>If you want to get a more in-depth understanding of Flakes, there's <a rel="noopener" target="_blank" href="https://nixos.org/manual/nix/stable/command-ref/new-cli/nix3-flake.html">documentation for the flake CLI</a>, as well as <a rel="noopener" target="_blank" href="https://nixos.wiki/wiki/Flakes">a wiki entry</a> and <a rel="noopener" target="_blank" href="https://xeiaso.net/blog/nix-flakes-1-2022-02-21">other</a> blog <a rel="noopener" target="_blank" href="https://ghedam.at/a-tour-of-nix-flakes">posts</a> trying to <a rel="noopener" target="_blank" href="https://serokell.io/blog/practical-nix-flakes">introduce</a> you to flakes.</p>
<p>For now, let's try to use the feature, and hopefully, we'll get a better understanding of it along the way.</p>
<!-- todo: what's a shell? add a "why" and a demo -->
<h2 id="enabling-flakes"><a class="zola-anchor" href="#enabling-flakes" aria-label="Anchor link for: enabling-flakes">Enabling flakes</a></h2>
<blockquote>
<p><strong>Note:</strong></p>
<p>Flakes are a (currently) experimental feature of Nix, and they've been present in the default distribution of Nix since release 2.4.
The &quot;experimental&quot; part sounds scary, but I've had a good and consistent experience for a year now, and it's probably a matter of (less rather than more) time until they are considered stable.</p>
</blockquote>
<p>First of all, you need Nix installed. For that, follow <a rel="noopener" target="_blank" href="https://nixos.org/download.html">the official installation guide</a> for your system.</p>
<p><a rel="noopener" target="_blank" href="https://nixos.wiki/wiki/Flakes">The wiki</a> lists several ways to enable flakes. I prefer this one:</p>
<p>Create the file <code>~/.config/nix/nix.conf</code> (if it doesn't exist) and add this line to it:</p>
<pre data-lang="conf" class="language-conf z-code"><code class="language-conf" data-lang="conf"><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">experimental-features</span> <span class="z-keyword z-operator z-genconfig">=</span></span> nix<span class="z-keyword z-operator z-genconfig">-</span>command flakes
</span></code></pre>
<h2 id="using-flakes"><a class="zola-anchor" href="#using-flakes" aria-label="Anchor link for: using-flakes">Using flakes</a></h2>
<p>The beauty of flakes is that you can build an arbitrary flake's output without dealing with the Nix language.</p>
<p>Now that you have enabled Flakes, you can run this:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> nix shell nixpkgs#cowsay</span>

<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cowsay boo</span>
 <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">_____</span></span>
<span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span> boo <span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span>
 <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">-----</span></span>
        <span class="z-constant z-character z-escape z-shell">\ </span>  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">^__^</span></span>
         <span class="z-constant z-character z-escape z-shell">\ </span> <span class="z-punctuation z-definition z-compound z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">oo</span></span><span class="z-punctuation z-definition z-compound z-end z-shell">)</span><span class="z-constant z-character z-escape z-shell">\_</span><span class="z-meta z-function-call z-arguments z-shell">______</span>
            <span class="z-punctuation z-definition z-compound z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">__</span></span><span class="z-punctuation z-definition z-compound z-end z-shell">)</span><span class="z-constant z-character z-escape z-shell">\ </span><span class="z-meta z-function-call z-arguments z-shell">      </span><span class="z-meta z-function-call z-shell"></span>)<span class="z-constant z-character z-escape z-shell">\/</span><span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span>                <span class="z-keyword z-operator z-logical z-or z-shell">||</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">----w</span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span>
                <span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-or z-shell">||</span>     <span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-or z-shell">||</span>
</span></code></pre>
<p>If that works, you've enabled flakes correctly. It's time to make our own flake.</p>
<h2 id="your-first-flake"><a class="zola-anchor" href="#your-first-flake" aria-label="Anchor link for: your-first-flake">Your first flake</a></h2>
<p>The simplest flake possible is one that produces no outputs:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">outputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-function z-4 z-nix">_</span> <span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span><span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>We'll talk about the syntax later.</p>
<p>Save this as <code>flake.nix</code> in a new directory and you'll be able to run:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> nix flake check</span>
</span></code></pre>
<p>The command should succeed with no output. Now let's make our flake a little more complicated...</p>
<p><img src="/images/rest-of-owl.jpg" alt="Draw the rest of the owl" /></p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>github:nixos/nixpkgs<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

  <span class="z-entity z-other z-attribute-name z-multipart z-nix">outputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-variable z-parameter z-function z-1 z-nix">nixpkgs</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-keyword z-operator z-nix">... </span><span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>
    <span class="z-keyword z-other z-nix">let</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">system</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">builtins</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">currentSystem</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-support z-function z-nix">import</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">system</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-keyword z-other z-nix">in</span>
    <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">devShells</span>.<span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">mkShell</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
        <span class="z-entity z-other z-attribute-name z-multipart z-nix">packages</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">cowsay</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>I know, that's a lot, but I promise we'll talk about it once we get it to work.</p>
<p>Save the file and run <code>nix flake check</code> again. It might take a little while, but ultimately you should see the following happen:</p>
<ul>
<li>
<p>A <code>flake.lock</code> file is created</p>
</li>
<li>
<p>The command fails spectacularly:</p>
<pre class="z-code"><code><span class="z-text z-plain">error: attribute &#39;currentSystem&#39; missing

      at /nix/store/ll6cvswyh6cm59rj3zzawlm8922fcfl0-source/flake.nix:6:16:

            5|     let
            6|       system = builtins.currentSystem;
            |                ^
            7|       pkgs = import nixpkgs { inherit system; };
(use &#39;--show-trace&#39; to show detailed location information)
</span></code></pre>
</li>
</ul>
<p>There's a reason why it failed (don't worry about it yet). You can get it to succeed if you add <code>--impure</code> to the command, but it's a workaround - as you can guess, we'll try to get rid of that soon.</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> nix flake check<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>impure</span></span>
</span></code></pre>
<p>Let's talk about what we've done so far. Specifically, let's talk about syntax!</p>
<h2 id="nix-syntax-101"><a class="zola-anchor" href="#nix-syntax-101" aria-label="Anchor link for: nix-syntax-101">Nix syntax 101</a></h2>
<p>In the parts that the two languages share, Nix is actually quite similar to JSON (see <a rel="noopener" target="_blank" href="https://nixos.org/manual/nix/stable/language/index.html">manual for the Nix syntax</a>).
The following JSON object:</p>
<pre data-lang="json" class="language-json z-code"><code class="language-json" data-lang="json"><span class="z-source z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>name<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>Jakub<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>power_level<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-constant z-numeric z-integer z-decimal z-json">9001</span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>languages<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json"><span class="z-punctuation z-section z-sequence z-begin z-json">[</span><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>Polish<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span><span class="z-punctuation z-separator z-sequence z-json">,</span> <span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>English<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span><span class="z-punctuation z-section z-sequence z-end z-json">]</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>uses_nix<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-constant z-language z-json">true</span>
<span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre>
<p>translates to the following Nix:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-comment z-line z-number-sign z-nix"># by the way, this is a line comment.</span>
<span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">name</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>Jakub<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">power_level</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-numeric z-nix">9001</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">languages</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span><span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>Polish<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>English<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">uses_nix</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>You should note the following key differences:</p>
<ul>
<li>entries in the object (Nix calls these <em>attribute sets</em>, or attrsets) are separated with <strong>semicolons</strong></li>
<li>the trailing semicolon is <strong>required</strong></li>
<li>keys/values are separated with the <strong>equals sign</strong></li>
<li>keys aren't wrapped in <strong>quotes</strong></li>
<li>array elements are <strong>separated with whitespace</strong></li>
<li><strong>comments</strong> are allowed.</li>
</ul>
<h2 id="nix-syntax-102-functions"><a class="zola-anchor" href="#nix-syntax-102-functions" aria-label="Anchor link for: nix-syntax-102-functions">Nix syntax 102: functions</a></h2>
<p>In addition to features known from formats like JSON, Nix has functions.
Functions in Nix are anonymous (they're lambdas), and they always take <strong>one</strong> argument each (multi-parameter functions are emulated either by means of currying or passing an attrset).</p>
<p>This is the general syntax for a function literal:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-variable z-parameter z-function z-4 z-nix">input</span> <span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-variable z-parameter z-name z-nix">body</span>
</span></code></pre>
<p>Looks familiar? We saw a similar one in the first flake we've made:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-variable z-parameter z-function z-4 z-nix">_</span> <span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span><span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>Here, we're seeing a new piece of syntax: the underscore. That just means we <strong>ignore</strong> the input and don't give it a name.</p>
<p>Functions are applied to arguments when they're separated by whitespace:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> try this in `nix repl`!</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nix-repl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> inc = x : x + 1</span>

<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nix-repl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> inc 1</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2</span></span>
</span></code></pre>
<p>To sum up all of the above, here's our initial flake definition, annotated:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-comment z-line z-number-sign z-nix"># This object right here defines a flake.</span>
<span class="z-comment z-line z-number-sign z-nix"># You&#39;ll see an object on the top level of every Nix flake in existence.</span>
<span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-comment z-line z-number-sign z-nix"># `outputs` is a special name in Nix</span>
  <span class="z-comment z-line z-number-sign z-nix"># which lets the tools know about all the possible outputs of a flake.</span>
  <span class="z-comment z-line z-number-sign z-nix"># It is a function that returns the outputs,</span>
  <span class="z-comment z-line z-number-sign z-nix"># and it receives the flake&#39;s inputs as the argument.</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">outputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span>
    <span class="z-comment z-line z-number-sign z-nix"># We don&#39;t produce any outputs, so we don&#39;t need any inputs.</span>
    <span class="z-comment z-line z-number-sign z-nix"># Thus, we ignore the argument.</span>
    <span class="z-variable z-parameter z-function z-4 z-nix">_</span> <span class="z-punctuation z-definition z-function z-nix">:</span>
    <span class="z-comment z-line z-number-sign z-nix"># Returning an empty object - no flake outputs yet.</span>
    <span class="z-punctuation z-definition z-attrset z-nix">{</span><span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<h2 id="a-flake-as-a-function"><a class="zola-anchor" href="#a-flake-as-a-function" aria-label="Anchor link for: a-flake-as-a-function">A flake as a function</a></h2>
<p>Just to repeat and rephrase: a flake's <code>outputs</code> attribute is a function that takes the flake's inputs as an argument.</p>
<p>In the second flake, we saw this function literal as the definition of <code>outputs</code>:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">outputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-variable z-parameter z-function z-1 z-nix">nixpkgs</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-keyword z-operator z-nix">... </span><span class="z-punctuation z-definition z-entity z-function z-nix">}</span> <span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span><span class="z-comment z-block z-nix">/* more stuff below */</span><span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>What is <code>nixpkgs</code>? What are the three dots? Let's start with the dots.</p>
<h3 id="triple-dot-syntax"><a class="zola-anchor" href="#triple-dot-syntax" aria-label="Anchor link for: triple-dot-syntax">Triple-dot syntax</a></h3>
<p>In the above snippet, we have a function literal that looks like this:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-variable z-parameter z-function z-1 z-nix">nixpkgs</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-keyword z-operator z-nix">... </span><span class="z-punctuation z-definition z-entity z-function z-nix">}</span> <span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span> <span class="z-comment z-block z-nix">/*...*/</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>When you see an attrset in the input position of a function, it means you're looking at a pattern match (or destructuring). <code>nixpkgs</code> will be considered a required attribute, but because of the three dots any extra arguments will be ignored - normally, if you only list specific attributes like in</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-variable z-parameter z-function z-1 z-nix">nixpkgs</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">another-flake</span> <span class="z-punctuation z-definition z-entity z-function z-nix">}</span> <span class="z-punctuation z-definition z-function z-nix">:</span>
</span></code></pre>
<p>then calling the function with any extra attributes provided at the call site will cause an error:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nix-repl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> f = <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> nixpkgs<span class="z-punctuation z-separator z-shell">,</span> other-flake <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span> : <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span>

<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nix-repl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> f <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> nixpkgs = 0; other-flake = 1; another-param = <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>oops<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">error:</span></span><span class="z-meta z-function-call z-arguments z-shell"> anonymous function at (string</span><span class="z-meta z-function-call z-shell"></span>)<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">:1:2</span></span><span class="z-meta z-function-call z-arguments z-shell"> called with unexpected argument <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>another-param<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span>

       <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">at</span></span><span class="z-meta z-function-call z-arguments z-shell"> ¬´string¬ª:1:1:</span>

            <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">1</span></span><span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">f</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> nixpkgs = 0; other-flake = 1; another-param = <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>oops<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span>
             <span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">^</span></span>
</span></code></pre>
<h3 id="nixpkgs"><a class="zola-anchor" href="#nixpkgs" aria-label="Anchor link for: nixpkgs">Nixpkgs</a></h3>
<p><a rel="noopener" target="_blank" href="https://github.com/NixOS/nixpkgs">Nixpkgs</a> is the main repository containing definitions of packages for Nix. At the time of writing, it's <a rel="noopener" target="_blank" href="https://repology.org/repositories/graphs">the largest package repository tracked by Repology</a>.</p>
<p>The <code>nixpkgs</code> parameter is the result of fetching the <code>nixpkgs</code> input. Remember, we defined our inputs as:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>github:nixos/nixpkgs<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-comment z-line z-number-sign z-nix"># ...</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>which is syntactic sugar for the following:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>github:nixos/nixpkgs<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-comment z-line z-number-sign z-nix"># ...</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>and it's Nix's equivalent of saying:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> git clone https://github.com/nixos/nixpkgs</span>
</span></code></pre>
<p>The <code>nixos/nixpkgs</code> GitHub repository will be tracked by Nix and within our flake aliased under the name <code>nixpkgs</code> (the name we defined for the input). By convention you'll usually see these names match the repository that the flake is coming from.</p>
<p>The first time an input is used in a flake command, Nix will <em>pin</em> it.
Pinning an input means that Nix will figure out the exact revision that it fetched, and it will make sure that everybody using this flake gets the exact same one.</p>
<p>At the time I'm writing this, pinning <code>github:nixos/nixpkgs</code> creates the following <code>flake.lock</code> file:</p>
<pre data-lang="json" class="language-json z-code"><code class="language-json" data-lang="json"><span class="z-source z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>nodes<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>nixpkgs<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
      </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>locked<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>lastModified<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-constant z-numeric z-integer z-decimal z-json">1666564341</span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>narHash<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>sha256-WXv7Ry6F9B8OtM0K1ye1ncaPaW/4Dwn8nDxFf2UPDWY=<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>owner<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>nixos<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>repo<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>nixpkgs<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>rev<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>09217f05bf29922c7e108c3143f11e0135ae0ded<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>type<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>github<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span>
      <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
      </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>original<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>owner<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>nixos<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>repo<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>nixpkgs<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>type<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>github<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span>
      <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
    <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>root<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
      </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>inputs<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>nixpkgs<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>nixpkgs<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span>
      <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
    <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
  <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>root<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>root<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>version<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-constant z-numeric z-integer z-decimal z-json">7</span>
<span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre>
<p>We don't need to talk about all of it (the file's main purpose is to be machine-readable), but please notice this part:</p>
<pre data-lang="json" class="language-json z-code"><code class="language-json" data-lang="json"><span class="z-source z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>rev<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span>: <span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">&quot;</span>09217f05bf29922c7e108c3143f11e0135ae0ded<span class="z-punctuation z-definition z-string z-end z-json">&quot;</span></span>,
</span></code></pre>
<p>That's <a rel="noopener" target="_blank" href="https://github.com/NixOS/nixpkgs/tree/09217f05bf29922c7e108c3143f11e0135ae0ded">the commit hash</a> of Nixpkgs's <code>master</code> branch that was found when I referenced the flake.</p>
<p>The lockfile makes sure that the flake's inputs are reproducible. In fact, if you copy-pasted <code>flake.nix</code> and <code>flake.lock</code> to another machine, Nix would guarantee that the same version of Nixpkgs would be used - kind of like saying &quot;after you clone this Git repository, always check out this revision&quot;.</p>
<p>Until you explicitly ask Nix to update an input (with something like <code>nix flake update</code>), it will remain unchanged. When you change it, the lockfile will be updated as well.</p>
<h2 id="flake-outputs"><a class="zola-anchor" href="#flake-outputs" aria-label="Anchor link for: flake-outputs">Flake outputs</a></h2>
<p>Let's look at the output we defined for our flake earlier.</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-comment z-line z-number-sign z-nix"># `nixpkgs` is in scope - we&#39;re in the body of the `outputs` function.</span>
<span class="z-keyword z-other z-nix">let</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">system</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">builtins</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">currentSystem</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-support z-function z-nix">import</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">system</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-keyword z-other z-nix">in</span>
<span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">devShells</span>.<span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">mkShell</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">packages</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">cowsay</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>Here, you can see <em>let bindings</em> in play: it's another feature of the Nix language.
A let binding declares a named value that can be used in the statements that follow.
In the snippet above, we define <code>system</code> and <code>pkgs</code> in a single binding so they can refer to each other.</p>
<p>Let's assume we're running an ARM-based Mac machine. The <code>builtins.currentSystem</code> string would have a value of <code>&quot;aarch64-darwin&quot;</code>, and our flake would return a single output: <code>devShells.aarch64-darwin.default</code>.</p>
<p>Some other popular system values you might want to use:</p>
<ul>
<li><code>aarch64-linux</code>, for ARM-based Linux</li>
<li><code>x86_64-linux</code>, for Intel-based Linux</li>
<li><code>x86_64-darwin</code>, for Intel-based macOS</li>
</ul>
<p>We can use that output by entering the development shell it defines:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> nix develop<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>impure <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> we still need this flag</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">bash-5.1$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cowsay boo</span>
 <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">_____</span></span>
<span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span> boo <span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span>
 <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">-----</span></span>
        <span class="z-constant z-character z-escape z-shell">\ </span>  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">^__^</span></span>
         <span class="z-constant z-character z-escape z-shell">\ </span> <span class="z-punctuation z-definition z-compound z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">oo</span></span><span class="z-punctuation z-definition z-compound z-end z-shell">)</span><span class="z-constant z-character z-escape z-shell">\_</span><span class="z-meta z-function-call z-arguments z-shell">______</span>
            <span class="z-punctuation z-definition z-compound z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">__</span></span><span class="z-punctuation z-definition z-compound z-end z-shell">)</span><span class="z-constant z-character z-escape z-shell">\ </span><span class="z-meta z-function-call z-arguments z-shell">      </span><span class="z-meta z-function-call z-shell"></span>)<span class="z-constant z-character z-escape z-shell">\/</span><span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span>                <span class="z-keyword z-operator z-logical z-or z-shell">||</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">----w</span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span>
                <span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-or z-shell">||</span>     <span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-or z-shell">||</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">bash-5.1$</span></span>
</span></code></pre>
<p>We're relying on a couple defaults here, but the <code>nix develop</code> command opened a Bash shell with the <code>cowsay</code> package already available on our <code>$PATH</code>. How did it happen?</p>
<p>First, we're relying on a couple defaults: <code>nix develop</code> on its own is equivalent to <code>nix develop .</code>, meaning &quot;the default shell for the flake in the working directory&quot;.</p>
<p>On top of that, <code>nix develop .</code> means Nix will try to use the first output it finds when trying the following:</p>
<ul>
<li><code>devShells.&lt;currentSystem&gt;.default</code>, or</li>
<li><code>packages.&lt;currentSystem&gt;.default</code>.</li>
</ul>
<p>For this article, we don't care about the latter.</p>
<p>Reading the &quot;current system&quot; is considered an impurity in Nix, and as such it's allowed in the command line, but not in pure evaluation mode (the default for Flakes): the expansion of the command happens in the CLI, whereas the evaluation of a flake happens in the Nix build system.</p>
<blockquote>
<p>An &quot;impurity&quot; here means it's not &quot;purely functional&quot;.
The purely functional paradigm only allows an expression to depend on the values of other expressions, and something like &quot;the current system&quot;, &quot;the current time&quot; or &quot;the current text of the file at path <code>/xyz</code>&quot; would require reaching beyond the scope of our code and getting the value from the local system.</p>
<p>Nix relies on purity to deliver some of its guarantees, so it encourages pure definitions for the code you write for it.
In Flakes, <code>--impure</code> is an escape hatch that allows breaking some of these rules of purity.</p>
</blockquote>
<h2 id="shells-and-packages"><a class="zola-anchor" href="#shells-and-packages" aria-label="Anchor link for: shells-and-packages">Shells and packages</a></h2>
<p>Back to our output - it's defined as the following:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">mkShell</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">packages</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">cowsay</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p><code>mkShell</code> is a <a rel="noopener" target="_blank" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell">function in Nixpkgs</a> that takes an attrset as an argument. One of the attributes in it is <code>packages</code>, which can be used to list... packages (who knew, right?) that will be available in the shell environment once it's loaded.</p>
<p><code>pkgs.cowsay</code> is a reference to one of the packages in Nixpkgs - you can search for these packages in a variety of ways, one which is <a rel="noopener" target="_blank" href="https://search.nixos.org/packages">search.nixos.org</a>.</p>
<p>We could get more packages into our shell by listing them in the attribute:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">scala-cli</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">openjdk11</span> <span class="z-punctuation z-definition z-list z-nix">]</span>
</span></code></pre>
<blockquote>
<p>As a matter of fact, these two packages showcase one of Nix's greatest features - isolation.
scala-cli has a runtime dependency on a Java runtime, and it requires it to be version 17 or above. &quot;But we're also adding openjdk11, surely that'll conflict, right?&quot;
Well, no - scala-cli's dependency is isolated: no other packages will see it.</p>
</blockquote>
<p>But wait! We didn't talk about <code>pkgs</code>, did we? Also, we still have this impurity of <code>builtins.currentSystem</code> that we should deal with, so that we don't need that <code>--impure</code> parameter in every call to the Nix CLI.</p>
<h2 id="systems-and-pkgs"><a class="zola-anchor" href="#systems-and-pkgs" aria-label="Anchor link for: systems-and-pkgs">systems and pkgs</a></h2>
<p><code>pkgs</code> was defined by using the <code>import</code> function (part of Nix's standard library):</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-keyword z-other z-nix">let</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">system</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">builtins</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">currentSystem</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-support z-function z-nix">import</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">system</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-keyword z-other z-nix">in</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span><span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>A couple things to explain here: <code>import x</code> means:</p>
<ol>
<li>read the file at path <code>x</code></li>
<li>parse it as a Nix expression</li>
<li>return that expression</li>
</ol>
<p>Additionally, we have a function call just after the import: you could've written the same thing as</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-keyword z-other z-nix">let</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-support z-function z-nix">import</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span><span class="z-punctuation z-definition z-expression z-nix">)</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">system</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span></code></pre>
<p>Finally, <code>inherit system</code> is syntactic sugar for <code>system = system</code>. We forward the value of <code>system</code> currently in scope or, in other words, we make the attrset &quot;inherit&quot; the <code>system</code> value from its definition's scope.</p>
<p>Reminder: <code>nixpkgs</code> is the input Nix fetched for our flake based on how we defined <code>nixpkgs</code> in the <code>inputs</code> section on the top-level of the flake.</p>
<p>Flake inputs are fetched to paths on the file system, and the value of the input (the <code>nixpkgs</code> value we got as a parameter of <code>outputs</code>) is that path. Given what we now know, we can tell that <code>pkgs</code> will be the result of calling some function defined in the Nix expression for Nixpkgs.</p>
<p>Here's the thing: packages in Nix can have different needs and different ways of being built, depending on what system they're being built for.
Most packages have dependencies on other, low-level packages (like the C compiler or another build tool), which are inherently platform-specific.
This is why you need to specify the system that Nixpkgs should use as a default when giving you access to packages.</p>
<p>So... we need a <code>system</code>. But <code>builtins.currentSystem</code> is impure, so how do we deal with that?</p>
<p>Remember: Nix's CLI already does the <code>currentSystem</code> check. We only really used it in the flake for convenience.</p>
<p>Assuming you only need your flake to work on one platform, you might as well hardcode the system like this:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-keyword z-other z-nix">let</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">system</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>aarch64-darwin<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-comment z-line z-number-sign z-nix"># or whatever system you have</span>
</span></code></pre>
<p>and it would work! Also, it would have no impurities. The day is saved... but is that it?</p>
<h2 id="supporting-multiple-systems"><a class="zola-anchor" href="#supporting-multiple-systems" aria-label="Anchor link for: supporting-multiple-systems">Supporting multiple systems</a></h2>
<p>With the change from above, our flake looks like this:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>github:nixos/nixpkgs<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

  <span class="z-entity z-other z-attribute-name z-multipart z-nix">outputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-variable z-parameter z-function z-1 z-nix">nixpkgs</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-keyword z-operator z-nix">... </span><span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>
    <span class="z-keyword z-other z-nix">let</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">system</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>aarch64-darwin<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-support z-function z-nix">import</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">system</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-keyword z-other z-nix">in</span>
    <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">devShells</span>.<span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">mkShell</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
        <span class="z-entity z-other z-attribute-name z-multipart z-nix">packages</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">cowsay</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>We can list all of its outputs using the <code>nix flake show</code> command:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> nix flake show</span>

<span class="z-variable z-other z-readwrite z-assignment z-shell">path:/Users/kubukoz/projects/flake-demos?lastModified</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">1666577116</span><span class="z-string z-unquoted z-shell">&amp;narHash=sha256-uq5VoRshQbQxkE0BL5Mgmb1eNguUIdtGaus1H50Oz6Y=</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">‚îî‚îÄ‚îÄ‚îÄdevShells</span></span>
    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">‚îî‚îÄ‚îÄ‚îÄaarch64-darwin</span></span>
        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">‚îî‚îÄ‚îÄ‚îÄdefault:</span></span><span class="z-meta z-function-call z-arguments z-shell"> development environment <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>nix-shell<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span>
</span></code></pre>
<p>We've eliminated the impurity from our flake, but at the cost of only supporting one system.
How can we add support for others?</p>
<p>Let's recap a couple facts:</p>
<ol>
<li>Flake outputs are system specific</li>
<li><code>builtins.currentSystem</code> is not allowed in pure evaluation mode</li>
<li>The Nix CLI (e.g. <code>nix develop</code>) knows what system it's running on</li>
<li>we <em>need</em> a system to make a <code>pkgs</code></li>
</ol>
<p>In theory, there's nothing stopping us from copy-pasting a bunch of code to support more systems:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>github:nixos/nixpkgs<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

  <span class="z-entity z-other z-attribute-name z-multipart z-nix">outputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-variable z-parameter z-function z-1 z-nix">nixpkgs</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-keyword z-operator z-nix">... </span><span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">devShells</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">aarch64-darwin</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-comment z-block z-nix">/* ... */</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">devShells</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">x86_64-darwin</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-comment z-block z-nix">/* ... */</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">devShells</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">aarch64-linux</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-comment z-block z-nix">/* ... */</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">devShells</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">x86_64-linux</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-comment z-block z-nix">/* ... */</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>but in practice, it gets real tedious real quick. It's boilerplate of the kind that we wouldn't like to maintain!</p>
<p>Thankfully, Nix's language and standard library offer ways to generate attrsets given a list of keys.
I won't get into the gnarly details (this is the kind of thing you learn in <a rel="noopener" target="_blank" href="https://nixos.org/guides/nix-pills/">Nix Pills</a>), but the solution I like most is a higher-order function that'll take the following arguments:</p>
<ul>
<li>a list of system names</li>
<li>a closure (function) that receives a system name and produces outputs <em>for that system</em>.</li>
</ul>
<p>The usage of that function, let's call it <code>eachSystem</code>, would look like this:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-variable z-parameter z-name z-nix">eachSystem</span> <span class="z-punctuation z-definition z-list z-nix">[</span><span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>aarch64-darwin<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>x86_64-darwin<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-comment z-block z-nix">/* etc. */</span><span class="z-punctuation z-definition z-list z-nix">]</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">system</span> <span class="z-punctuation z-definition z-function z-nix">:</span>
  <span class="z-keyword z-other z-nix">let</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-support z-function z-nix">import</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">system</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-keyword z-other z-nix">in</span>
  <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">devShells</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">mkShell</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">packages</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">cowsay</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span>
</span></code></pre>
<p>By pure accident and not a completely deliberate choice of naming/syntax, this already exists!
It's indeed named <code>eachSystem</code> and it's provided by <a rel="noopener" target="_blank" href="https://github.com/numtide/flake-utils/">the <code>flake-utils</code> flake</a>.</p>
<p>With flake-utils, our final flake could look like this:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>github:nixos/nixpkgs<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">flake-utils</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>github:numtide/flake-utils<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

  <span class="z-entity z-other z-attribute-name z-multipart z-nix">outputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-variable z-parameter z-function z-1 z-nix">nixpkgs</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">flake-utils</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-keyword z-operator z-nix">... </span><span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>
    <span class="z-variable z-parameter z-name z-nix">flake-utils</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">eachSystem</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>aarch64-darwin<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>x86_64-darwin<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-punctuation z-definition z-list z-nix">]</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span>
      <span class="z-keyword z-other z-nix">let</span>
        <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-support z-function z-nix">import</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">system</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-keyword z-other z-nix">in</span>
      <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
        <span class="z-entity z-other z-attribute-name z-multipart z-nix">devShells</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">mkShell</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">packages</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">cowsay</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>flake-utils provides a <code>lib</code> output that doesn't require a system - it only uses Nix's standard library to transform the list of systems and the function we pass to it.</p>
<p>The <code>eachSystem</code> function will take the list of systems we want to support, and make sure the <code>default</code> entry in <code>devShells</code> ends up under the key specific to each system:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> nix flake show</span>

<span class="z-variable z-other z-readwrite z-assignment z-shell">path:/Users/kubukoz/projects/flake-demos?lastModified</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">1666579399</span><span class="z-string z-unquoted z-shell">&amp;narHash=sha256-l3Vr9psJPPsbBzZ00XSWhlcZHGonMX3rVxO51G+G1zc=</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">‚îî‚îÄ‚îÄ‚îÄdevShells</span></span>
    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">‚îú‚îÄ‚îÄ‚îÄaarch64-darwin</span></span>
    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">‚îÇ</span></span><span class="z-meta z-function-call z-arguments z-shell">   ‚îî‚îÄ‚îÄ‚îÄdefault: development environment <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>nix-shell<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span>
    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">‚îî‚îÄ‚îÄ‚îÄx86_64-darwin</span></span>
        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">‚îî‚îÄ‚îÄ‚îÄdefault:</span></span><span class="z-meta z-function-call z-arguments z-shell"> development environment <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>nix-shell<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span>
</span></code></pre>
<p>You might also want to try <a rel="noopener" target="_blank" href="https://github.com/numtide/flake-utils/#eachdefaultsystem---system---attrs"><code>eachDefaultSystem</code></a>, which hardcodes the list of systems to the &quot;default&quot; platforms <a rel="noopener" target="_blank" href="https://github.com/numtide/flake-utils/blob/c0e246b9b83f637f4681389ecabcb2681b4f3af0/default.nix#L3-L9">listed in flake-utils</a>. Also, check out <a rel="noopener" target="_blank" href="https://github.com/numtide/flake-utils/#simpleflake---attrs---attrs"><code>simpleFlake</code></a>.</p>
<h2 id="on-ease-of-use"><a class="zola-anchor" href="#on-ease-of-use" aria-label="Anchor link for: on-ease-of-use">On ease of use</a></h2>
<p>Now, I know all of this is pretty complicated. There's still a high barrier to entry and a steep learning curve to getting started with Nix, even with Flakes being an attempt to simplify the ways of working with it.
There are <a rel="noopener" target="_blank" href="https://github.com/NixOS/nix/issues/3843">ongoing</a> discussions around the <a rel="noopener" target="_blank" href="https://github.com/NixOS/nix/issues/3849">usability</a> of Nix and of Flakes, and we're likely to see improvements to it in the future, but so far it's as simple as it gets.</p>
<p>While I wish it could be simplified for the beginner user, I understand that Nix deals with a lot of essential complexity (inherent to the problem it attempts to solve). It's not optimizing for the &quot;hello world&quot; experience - it optimizes for the build system working at scale, when the builds and shells get more convoluted.
I trust that its creators know how complex the average build can get, given they've been working with this ecosystem for almost 20 years.</p>
<p>There are other tools built on top of Nix that provide a more newcomer-friendly experience. One of them is <a rel="noopener" target="_blank" href="https://github.com/numtide/devshell">devshell</a> (which I think could use some simplification in the documentation). If you want to get the Nix shell powers without forcing your entire team to learn the language, that might work for you.</p>
<h2 id="parting-words"><a class="zola-anchor" href="#parting-words" aria-label="Anchor link for: parting-words">Parting words</a></h2>
<p>To sum up, in this article we covered:</p>
<ul>
<li>a brief introduction to Nix and Flakes</li>
<li>defining a Nix shell in a flake</li>
<li>some parts of the Nix language's syntax</li>
<li>supporting multiple systems</li>
</ul>
<p>as well as a couple other things.</p>
<p>I hope that it gives you a decent enough introduction to Flakes that will help you start enjoying the benefits of Nix, as well as encourage you to learn the parts we didn't cover, on your own.</p>
<p>If you have any questions that you feel this post should've answered but didn't, let me know in the comments below.
Thanks for reading!</p>
<h2 id="acknowledgements"><a class="zola-anchor" href="#acknowledgements" aria-label="Anchor link for: acknowledgements">Acknowledgements</a></h2>
<p>Many thanks to <a rel="noopener" target="_blank" href="https://github.com/Baccata/">Olivier M√©lois</a> for an initial read of this post.</p>

    </div>

    
    <div class="article-info">
        
        <div class="article-date">22 October 2022</div>
        
        <div class="article-taxonomies">
            
            
                <ul class="article-tags">
                    
                    <li><a href="https://blog.kubukoz.com/tags/nix/">#nix</a></li>
                    
                </ul>
            
        </div>
    </div>

</article>


<div id="disqus_thread"></div>
<script>
  /**
   *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
   *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */

  var disqus_config = function () {
    this.page.url = "https://blog.kubukoz.com";
    this.page.identifier = '/flakes-first-steps';
  };

  (function () {
    // DON'T EDIT BELOW THIS LINE
    var d = document,
      s = d.createElement("script");
    s.src = "https://kubukoz-blog.disqus.com/embed.js";
    s.setAttribute("data-timestamp", +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>
 
        </main>
        <footer>
            <p>
                ¬© Jakub Koz≈Çowski (<a href="https://twitter.com/kubukoz">@kubukoz</a>) 2022<br>
                Powered by <a target="_blank" href="https://getzola.org/">Zola</a>, Theme <a target="_blank" href="https://github.com/zbrox/anpu-zola-theme">Anpu</a>.
            </p>
            <p>
                
                
            </p>
        </footer>
    </div>
</body>
<!-- Google Analytics Tracking code -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-55943015-8', 'auto');
    ga('send', 'pageview');

    </script>
</html>
